{% extends 'base.html' %}

{% block title %}Edit {{ activity.title }} - H5P Demo{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="{% url 'sample_lms:course_list' %}">Courses</a> &raquo;
    <a href="{% url 'sample_lms:course_detail' activity.course.id %}">{{ activity.course.title }}</a> &raquo;
    Edit: {{ activity.title }}
</div>

<div class="card">
    <h2>Edit H5P Content</h2>
    <p style="color: #666; margin-bottom: 15px;">
        Make changes to your H5P content. Click "Save Content" when done.
    </p>

    <div class="iframe-container" style="height: 700px;">
        <iframe
            id="h5p-editor"
            src="{{ h5p_server_url }}/edit/{{ activity.h5p_server_id }}?userId={{ user_id }}&returnUrl={{ return_url|urlencode }}"
            allow="fullscreen"
        ></iframe>
    </div>

    <div style="margin-top: 15px;">
        <a href="{% url 'sample_lms:activity_view' activity.id %}" class="btn btn-secondary">Cancel</a>
        <a href="{% url 'sample_lms:activity_launch' activity.id %}" class="btn">Preview</a>
    </div>
</div>

<script>
// Listen for messages from H5P editor
window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'h5p-saved') {
        // Content was saved - redirect back
        window.location.href = '{% url "sample_lms:activity_view" activity.id %}';
    } else if (event.data && event.data.type === 'h5p-cancel') {
        window.location.href = '{% url "sample_lms:activity_view" activity.id %}';
    }
});
</script>
{% endblock %}
